---

title: 计算机网络五层协议栈

layout: post

---

结合OSI和TCP/IP的五层协议栈

* **物理层**：如何在一条通信信道上传输原始**比特**，确定与传输介质有关的机械特性、电气特性、功能特性和规程特性

* **数据链路层**：如何把数据组织成帧以及如何在网络中传输**帧**

* **网络层**：如何分配地址，如何把**数据包**从网络的一端传输到另一端

* **传输层**：如何处理可靠传输的细节

* **应用层**：应用程序如何使用网络

注：TCP/IP模型将OSI的应用层、表示层和会话层合并为应用层

##**1. 物理层**

物理层是所有网络的基础，物理性质决定了所有信道必须遵循尼奎斯特抽样定理和香农定理，这也决定了它们的带宽。

带宽/brandwidth：（模拟）带宽是以 赫兹/Hz 来度量的；（数字）带宽则表示一个信道的最大数据速率，以 每秒多少比特/bps 来度量。

尼奎斯特抽样定理：在带宽为 B 的传输系统上的最大数据传输速率为 2B，更一般的情况是，如果传输系统使用K种不同电压（而非两种）进行数据编码，则最大传输速率为 2Blog2K。

实际通信系统中总会受到噪声干扰，香农定理：对一条带宽为 B Hz，信噪比是 S/N 的有噪声信道，最大数据传输速率为 Blog2(1+S/N)。

**传输介质**

传输介质分为引导性（即有线）和非引导性（无线）介质。主要的引导性介质有双绞线、同轴电缆和光纤；非引导性介质包括无线电、微波、红外线、激光和卫星。

双绞线：两根铜线螺旋绞绕，这样更能降低噪声。总共有1-7类，其中使用最多的为5类线，而1到6类都为非屏蔽双绞线，7类线为昂贵的屏蔽双绞线。

同轴电缆：分为50欧姆和75欧姆，50欧姆常用于数字传输；75欧姆常用于模拟传输和有线电视。

光纤：分为多模光纤和单模光纤（昂贵），传输速率高。

**数字调制与多路复用**

数字调制通过介质上的模拟信号来发送比特，是将比特转换成代表他们的信号的过程。对信号以基带方式进行线性编码后通过调幅、调频和调相等方式放到通带上传送。

1、基带传输：信号的传输占有传输介质上从零到最大值之间的全部频率。

数字调制最直接的形式为用正电压表示1，负电压表示0。如近距离异步串行通信的RS-232标准（正负15V）。

2、通带传输：信号占据了以载波信号频率为中心的一段频带。

采用载波进行调制可以使信号传得更远，一般分为调幅、调频和调相。

3、通信的方式可分为单共通信、半双工通信和全双工通信。

4、复用可以分为频分复用FDM（多个不同频率的信号共享同一信道）、时分复用TDM（不同信号以循环的方式轮流使用信道）和码分复用CDM（扩展频谱，把窄带信号扩展到一个宽的频带上）。

##**2. 数据链路层**

数据链路层从源机器的网络层取得数据并打包成帧传输到目标机器的网络层。

数据链路层根据需要可提供三种服务：无确认的无连接服务（如以太网）、有确认的无连接服务（如802.11无线网）和有确认的有连接服务（如卫星通信）。

数据成帧方法有以下四个：字节计数法（利用头部的一个字段来标识该帧字符数，易出错）、字节填充的标志字节法（帧前后加入特殊的字节标志）、比特填充的标志比特法（常用）和物理层编码违禁法。

**差错检测和纠正**

错误处理的两种策略：纠错码和检错码。前者通过在每一个数据块中加入足够多的冗余信息，以便接收方可以据此推断出被发送到数据；后者只需加入一些能让接收方判断是否发生错误的冗余，后接收方可以请求重传。

纠错码常用于容易出错的无线链路，包括海明码、二进制卷积码、里德所罗门码和低密度奇偶校验码。

检错码则用于错误率低的链路，包括奇偶校验、校验和和**循环冗余校验**。

**局域网技术与网络拓扑**

计算机通信分为直接点对点通信和共享信道通信。

局域网拓扑结构：星型拓扑如ATM、环型拓扑如令牌环、总线型拓扑如以太网。

以太网采用曼彻斯特编码，不像RS232检测固定的电压值，而是检测电压的变化，上升沿编码为1，下降沿编码为0。

以太网采用的协调传输机制是带冲突检测的载波侦听多址接入CSMA/CD，计算机在发送帧之前要等待以太网空闲，若两台计算机同时发送会产生冲突，此时计算机采用指数退避法选择哪台计算机发送。每台计算机在尝试再次发送之前都要延迟一段随机时间，这个时间在随后的每次冲突都会加倍。

无线局域网采用协调传输机制是避免冲突的载波侦听多址接入CSMA/CA，它不依赖于所有计算机都能接受到传输，而是在传输一个分组前由接收者发送很短的控制报文。

以太网帧格式：8前导序列 + 6目标地址 + 6源地址 + 2帧类型 + 46-1500帧中数据 + 4CRC = 72-1526字节

* 前导序列用于同步，每个字节包含比特模式10101010（除最后一个字节的后两位为11）。

* 目标地址第一位是0则为普通地址（单播），1则表示组地址（组播），全1的地址保留用作广播。

* 源地址是IEEE分配的全球唯一的物理地址/MAC地址。

**局域网扩展技术**

* 中继器：物理层设备。接收一个网段的所有信号，放大并转发到另一个网段。

* 网桥：链路层设备。接受一个网段的完整且正确的帧并转发到另一个网段。

* 网桥回路会产生广播风暴，使用分布生成树算法可以解决这个问题。

* 集线器可以看成是多端口的中继器；交换机可以看成是多端口的网桥。

注：路由器是网络层的概念。

##**3. 网络层**

全局服务要求通信系统允许任意两台计算机进行通信，即网络互连，它既可以基于面向连接的虚电路，也可以基于无连接的数据报。网络互连使用路由器来连接异构网络。

最广泛使用于网络层的协议是TCP/IP协议。IP协议为每台主机分配了一个唯一的与物理地址无关的IP地址，IP地址由前缀和后缀两部分组成，总共分为ABCDE五类，ABC为三个基本类用于分配主机地址，D用于组播，E类保留。

协议地址与硬件地址之间的映射过程叫地址解析，地址解析技术包括查表法（常用于广域网）、封闭式计算法（常用于动态编址网）和报文交换法（常用于静态编址网）。ARP协议规定请求报文是广播的，而响应报文是直接发送的，常用于32位IP地址跟48位以太网地址的解析。

IP数据报是一种与底层无关的互联网分组格式，其头部包含的是IP地址，传输时会将数据报封装到帧里，帧的目的地址为数据报应送往的下一站MAC地址，而数据报中的IP地址始终为最终目的IP地址。

数据报的长度不能大于所经网络的最大传输单元MTU，因此常常会进行分片与重装。

因为是无连接服务，数据报传输过程中会发生丢失、重复、延迟和乱序等问题。互联网控制报文协议ICMP包括差错报文和信息报文，ICMP报文通过封装进IP报文进行传输，常用于测试可达性ping、跟踪路径tracert、发现通路MTU。

服务质量：吞吐量、时延（分组时延、排队时延、交换时延和传播时延）、抖动和漂移（都是时延变化）。

IP路由技术可以分为静态路由和动态路由，多数主机采用静态路由。

因特网路由协议包括内部网关协议IGP和外部网关协议EGP，每个自治系统中选择使用各自的IGP，两个自治系统AS的两个边界路由器通过EGP进行传输。流行的内部网关协议有路由信息协议RIP（采用距离矢量算法）和开放最短通路优先协议OSPF（采用链路状态算法），外部网关协议常用的有边界网关协议BGP。

##**4. 传输层**

TCP/IP传输有两个协议：数据报协议UDP和传输控制协议TCP。

UDP是端到端、无连结、面向报文、尽力而为的。并且允许一对一、一对多、多对一和多对多交互通信。UDP可用于C/S交互，也可用于建立实时协议。

TCP是面向连结、点对点、可靠、全双工的。允许两个应用程序建立连结并在任一方向上发送数据，然后终止连结。

可靠的TCP协议要建立在不可靠的IP协议上，需要使用各种不同的技术。

最重要的技术是重传。重传是当发送方发送数据时会启动一个定时器，若超时之前未收到接收方收到数据的确认报文，则发送方会重新发送数据。自适应重传指的是发送方的等待时间是自适应的，会根据最近的报文往返时间进行加权平均结合方差计算。

TCP使用一种流量控制窗口（缓冲区）机制来控制数据流，防止发送方数据淹没接收方。

TCP还使用一种拥塞窗口，通过慢速启动慢慢增加拥塞窗口，当检测到丢包时迅速减小窗口，以防止拥塞崩溃。（网络拥塞使用分组丢失率衡量）

TCP的连结和建立都采用三次握手的方式。

##**5. 应用层**


