---

title: 微信开发之帐号绑定

layout: post

---
菜鸟血泪多，最近做公众号开发又遇到一个问题：如何将订阅到用户与系统进行绑定，多方查证之后终于从招商银行的案例中找到一种较为靠谱的方式——openid。

##**OPENID**

首先要知道的一个前提就是，公众号无法得到用户的真实微信号，取而代之的是一个openid。并且，每个用户对不同公众号的openid都是惟一且不同的。

也就是说，对公众号来说，哪怕某个调皮的用户取消再关注一百次，他的openid（确切的说是他和我的openid）都是一样的。因此我们要做的就是在系统中将每个用户与openid进行绑定。

###**绑定**

参照招商银行的案例，绑定的流程其实很简单：

1. 用户在微信端发送请求
2. 服务器取出openid并查找用户表
3. 未找到则返回带有openid参数的链接给用户
4. 用户点击链接输入账号密码进行绑定
5. 用户返回微信。

实现起来也很容易，但特别需要注意的是安全问题，除了用户名密码保密之外，openid也不能泄露，可以采取的措施有：

* 将openid放入session
* 对openid进行加密
* 给绑定链接加上过期时间
* 给绑定链接加上密钥
* 将这些信息打包生成签名

最后附上实现代码的片段：

{% gist 8134128 %}